container_commands:
  01-create-storage-dirs:
    command: |
      mkdir -p /var/app/current/storage/framework/cache
      mkdir -p /var/app/current/storage/framework/sessions
      mkdir -p /var/app/current/storage/framework/views
      mkdir -p /var/app/current/storage/logs
      mkdir -p /var/app/current/bootstrap/cache
      chown -R webapp:webapp /var/app/current/storage /var/app/current/bootstrap/cache
      chmod -R 775 /var/app/current/storage /var/app/current/bootstrap/cache

  02-clear-cache:
    command: |
      php artisan config:clear
      php artisan route:clear
      php artisan view:clear

  03-optimize:
    command: |
      php artisan config:cache
      php artisan route:cache
      php artisan view:cache
    env:
      APP_ENV: production

files:
  "/etc/php.d/99-custom.ini":
    mode: "000644"
    owner: root
    group: root
    content: |
      upload_max_filesize = 20M
      post_max_size = 25M
      memory_limit = 256M
